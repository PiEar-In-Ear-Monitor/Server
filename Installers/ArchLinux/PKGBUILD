# Maintainer: Alex O'Connor <Alex.nderOConnor@gmail.com>
pkgname=piear
pkgver=0.6.0
pkgrel=1
pkgdesc="A Software based in-ear solution"
arch=('x86_64')
url="https://github.com/PiEar-In-Ear-Monitor/Server"
license=('custom:MIT')
groups=()
depends=(portaudio nodejs)
makedepends=(cmake gcc boost nlohmann-json npm)
checkdepends=(gtest)
optdepends=()
provides=(piear)
conflicts=()
replaces=()
backup=()
options=()
install=$pkgname.install
changelog=
source=("$pkgname-$pkgver.tar.gz::https://github.com/PiEar-In-Ear-Monitor/Server/archive/refs/tags/v$pkgver.tar.gz")
noextract=()
sha256sums=(SKIP)
validpgpkeys=()
prepare() {
    tar -xvf "$pkgname-$pkgver.tar.gz"
    mv "Server-$pkgver/" "$pkgname"
}
build() {
    cd "$pkgname"
    cmake -DCMAKE_INSTALL_PREFIX=/usr -DPACKAGE_TESTS=OFF -DCMAKE_BUILD_TYPE=Release -B build
    cmake --build build
}
package() {
    cd "$pkgname"
    npm --prefix webserver install
    cmake --install build --prefix $pkgdir/usr
    mkdir -p $pkgdir/usr/share/licenses/piear
    cp LICENSE $pkgdir/usr/share/licenses/piear/LICENSE-MIT
    mkdir -p $pkgdir/lib/systemd/service
    cp Installers/ArchLinux/piear.service $pkgdir/lib/systemd/service
}
